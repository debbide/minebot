// ==UserScript==
// @name         FreezeHost AFK è‡ªåŠ¨æŒ‚æœº (v17 é›¶ç‚¹çªç ´ç‰ˆ)
// @namespace    http://tampermonkey.net/
// @version      17.0
// @description  è§£å†³å€’è®¡æ—¶0:00å¡ä½ä¸åˆ·æ–°çš„é—®é¢˜ï¼ŒåŠ å…¥å¼ºåˆ¶é‡ç½®é€»è¾‘
// @author       Gemini
// @match        https://free.freezehost.pro/earn
// @grant        none
// ==/UserScript==

(function() {
    'use strict';

    const CHECK_INTERVAL = 1000;

    // --- çŠ¶æ€é¢æ¿ ---
    const infoBox = document.createElement('div');
    Object.assign(infoBox.style, {
        position: 'fixed', bottom: '20px', right: '20px', padding: '12px 16px',
        backgroundColor: 'rgba(0, 0, 0, 0.9)', color: '#fff', borderRadius: '8px',
        zIndex: '999999', fontFamily: 'monospace', fontSize: '12px',
        borderLeft: '5px solid #888', boxShadow: '0 4px 15px rgba(0,0,0,0.6)',
        minWidth: '240px'
    });
    infoBox.innerHTML = 'è„šæœ¬ v17 åˆå§‹åŒ–...';
    document.body.appendChild(infoBox);

    // --- ç‚¹å‡»å‡½æ•° ---
    function triggerClick(element, actionName) {
        console.log(`[Action] ç‚¹å‡»: ${actionName}`);
        element.style.border = "4px solid #fff";
        const opts = { bubbles: true, cancelable: true, view: window };
        element.dispatchEvent(new MouseEvent('mousedown', opts));
        element.dispatchEvent(new MouseEvent('mouseup', opts));
        element.click();
        setTimeout(() => { if (element) element.style.border = ""; }, 500);
    }

    // --- æ›´æ–°é¢æ¿ ---
    function updateHUD(color, status, detail, action) {
        infoBox.style.borderLeftColor = color;
        infoBox.innerHTML = `
            <div style="font-size:14px; font-weight:bold; color:${color}; margin-bottom:6px;">${status}</div>
            <div style="color:#bbb; margin-bottom:4px;">ğŸ“Š çŠ¶æ€: <span style="color:#fff">${detail}</span></div>
            <div style="color:#888; border-top:1px solid #444; padding-top:4px; font-size:11px;">
               ğŸ¤– åŠ¨ä½œ: <span style="color:${color}">${action}</span>
            </div>
        `;
    }

    // --- ä¸»å¾ªç¯ ---
    function loop() {
        const bodyText = document.body.innerText;
        const startBtn = document.getElementById('start-afk-btn');
        const timerElement = document.getElementById('session-timer');
        const timerText = timerElement ? timerElement.innerText.trim() : "";

        // =================================================================
        // 0. ç‰¹æ®Šæƒ…å†µå¤„ç†ï¼šå€’è®¡æ—¶å½’é›¶ (0:00)
        // =================================================================
        // è¿™æ˜¯ä¸ºäº†è§£å†³ä½ æˆªå›¾é‡Œå¡åœ¨ 0:00 çš„é—®é¢˜ã€‚
        // åªè¦çœ‹åˆ° 0:00ï¼Œä¸ç®¡å…¶ä»–æ–‡å­—æ˜¾ç¤ºä»€ä¹ˆï¼Œç›´æ¥åˆ¤æ­»åˆ‘ -> åˆ·æ–°ã€‚
        if (timerText === "0:00" || timerText === "00:00") {
            updateHUD("#ff00ff", "æ—¶é—´è€—å°½", "æ£€æµ‹åˆ° 0:00 å¡æ­»", "å¼ºåˆ¶åˆ·æ–°é¡µé¢...");
            console.log("å€’è®¡æ—¶å½’é›¶ï¼Œå¼ºåˆ¶é‡ç½®...");

            // å°è¯•æ‰¾ä¸€ä¸‹ç»­æœŸæŒ‰é’®ï¼Œå¦‚æœæœ‰å°±ç‚¹ï¼Œæ²¡æœ‰å°±ç›´æ¥åˆ·æ–°ç½‘é¡µ
            const renewBtnResult = document.evaluate("//button[contains(., 'Start New Session')]", document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null);
            const renewBtn = renewBtnResult.singleNodeValue;

            if (renewBtn) {
                renewBtn.click();
            } else {
                // ç­‰å¾… 2 ç§’ååˆ·æ–°ï¼Œç»™ç½‘é¡µä¸€ç‚¹ååº”æœºä¼š
                setTimeout(() => location.reload(), 2000);
            }
            return;
        }

        // =================================================================
        // 1. æ­£å¸¸ç»­æœŸ (Start New Session)
        // =================================================================
        const renewBtnResult = document.evaluate("//button[contains(., 'Start New Session')]", document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null);
        const renewBtn = renewBtnResult.singleNodeValue;
        if (renewBtn && renewBtn.offsetParent !== null) {
            updateHUD("#ff00ff", "Session å®Œæˆ", "ç­‰å¾…åˆ·æ–°", "ç‚¹å‡» Start New Session");
            triggerClick(renewBtn, "Start New Session");
            return;
        }

        // =================================================================
        // 2. æŒ‚æœºè¿è¡Œä¸­ (You are now earning coins)
        // =================================================================
        if (bodyText.includes("You are now earning coins") || bodyText.includes("1 coin will be added")) {
            if (startBtn) {
                startBtn.style.border = "2px dashed #444";
                startBtn.style.opacity = "0.5";
            }
            updateHUD("#00ccff", "ç¨³å®šæŒ‚æœºä¸­...", `å€’è®¡æ—¶: ${timerText}`, "é™é»˜ç›‘æ§ (ç¦æ­¢æ“ä½œ)");
            return;
        }

        // =================================================================
        // 3. æ–­çº¿/æœªå¼€å§‹ (ç‚¹å‡» Start AFK Session)
        // =================================================================
        if (startBtn) {
            updateHUD("#00ff00", "å‡†å¤‡å°±ç»ª / æ–­çº¿", "å½“å‰å¤„äºé—²ç½®çŠ¶æ€", "ç‚¹å‡» Start AFK Session");
            triggerClick(startBtn, "Start AFK Session");
            return;
        }

        updateHUD("#888", "åŠ è½½ä¸­...", "æ­£åœ¨åˆ†æé¡µé¢", "ç­‰å¾…æŒ‰é’®å‡ºç°");
    }

    setInterval(loop, CHECK_INTERVAL);
    console.log("FreezeHost v17 (é›¶ç‚¹çªç ´ç‰ˆ) å·²å¯åŠ¨");

})();